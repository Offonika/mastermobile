# Clarification Checklist — «Ассистент мастера» v0.1

> Критичные вопросы для v0.1 (Telegram бот + Bitrix). Использовать как чек-лист с владельцами решений. Ответы после согласования дублируем в профильные разделы Spec Kit.

| Topic | Question | Our Default | Decision Owner | Needed By | Impact if Unknown | Spec Reference |
| --- | --- | --- | --- | --- | --- | --- |
| A. Bitrix | 1. Какие версии ядра и модулей Bitrix (sale, catalog, iblock, rest) доступны на проде/стейдже? | ✅ Default: «Bitrix: Управление сайтом 25.x; REST v1; sale+catalog latest». | Bitrix админ / интегратор | До начала настройки окружений (Sprint 0) | Риск несовместимости API, срыв интеграции и тестов. | Зафиксировать в `bitrix-integration.md` §1 после подтверждения. |
| A. Bitrix | 2. Какие REST-эндпоинты используем для цен, остатков, заказов, обновлений статусов и возвратов? | ✅ Default: `catalog.product*`, `catalog.price.list`, `catalog.storeproduct.list`, `sale.*`; подтвердить точные методы. | Интеграции (Bitrix) | Перед реализацией клиентских вызовов (Sprint 1) | Возможные 404/403, нарушение идемпотентности, блокеры по заказам. | Таблица §2 в `bitrix-integration.md`. |
| A. Bitrix | 3. Каковы rate limits/квоты Bitrix? | ✅ Default: 2–5 rps на токен; реализовать backoff + идемпотентность. | Интеграции / DevOps | До настройки ретраев (Sprint 1) | Троттлинг и падение SLA бота. | НФТ §5 «Rate limits» в `bitrix-integration.md`. |
| A. Bitrix | 4. Какие типы цен и валюта (опт/розница/акции)? | ✅ Default: основной тип цены, валюта RUB. | Продакт + Bitrix админ | До дизайна карточек и оплаты (Sprint 1) | Некорректные цены для пользователей, ошибки расчёта оплат. | Заполнить §2 «Цены/остатки» в `bitrix-integration.md`. |
| A. Bitrix | 5. SKU/master data: уникальность SKU, наличие штрихкодов? | ✅ Default: SKU уникален; штрихкод опционален. | Каталог-менеджер | До импорта каталога (Sprint 1) | Невозможность матчить заказы и остатки, коллизии в корзине. | Раздел §2 описания SKU в `bitrix-integration.md`. |
| A. Bitrix | 6. Источник остатков: один склад или несколько? | ✅ Default: один склад (default store); мульти-склад v0.2. | Операции / Логистика | До настройки расчёта остатка (Sprint 1) | Неверные остатки, ошибочные обещания доставки. | `bitrix-integration.md` §2 «storeproduct.list». |
| A. Bitrix | 7. Маппинг статусов Bitrix → бот: какие статусы реально используются? | ✅ Default: NEW → PAID → PICKING → SHIPPED/DELIVERED/CLOSED; указать фактические коды. | Bitrix админ + Продакт | Перед запуском уведомлений (Sprint 1) | Некорректные уведомления, пропущенные SLA. | Таблица §3 «Маппинг статусов» в `bitrix-integration.md`. |
| B. Telegram | 8. Какие точки входа: команды, реплай-клавиатура, inline? | ✅ Default: команды + reply keyboard; inline mode не нужен в v0.1. | Продакт бота | До описания UX команд (Sprint 0) | Лишний объём разработки, неучтённые UX-сценарии. | `blueprint.md` §3 (сценарии) и §5 (последовательность). |
| B. Telegram | 9. Модель аутентификации: по чату или с подтверждением телефона? | ✅ Default: чат-биндинг по Telegram user id; опциональная привязка телефона позже. | Безопасность + Продакт | До реализации авторизации (Sprint 1) | Нельзя связать пользователя с Bitrix-клиентом, риски мошенничества. | `blueprint.md` §4 (архитектура) и `operating-notes.md` §5. |
| B. Telegram | 10. Ограничения на размер сообщений и кнопок? | ✅ Default: пагинация >8 пунктов; обрезка названий >60 символов. | Продакт бота | До проектирования UI (Sprint 1) | Триггеры ошибок Telegram, испорченный UX. | `blueprint.md` §3 и гайдлайны в `operating-notes.md` §4. |
| C. Payments | 11. Где происходит предоплата: ссылка Bitrix или внутри бота? | ✅ Default: создаём заказ в Bitrix, выдаём платёжную ссылку Bitrix; бот — реле. | Финансы + Интеграции | До интеграции оплаты (Sprint 1) | Несогласованный платёжный флоу, нарушение кассовой дисциплины. | `bitrix-integration.md` §2 (order.add) и `blueprint.md` §5 шаг 6–7. |
| C. Payments | 12. Политика статусов оплаты/отмены и SLA? | ✅ Default: ожидание 20 мин → автоотмена; SLA 24 ч на ручную обработку. | Финансы / Операции | До настройки уведомлений (Sprint 1) | Висящие неоплаченные заказы, конфликт со складами. | `operating-notes.md` §1 и §2. |
| D. «Неси» | 13. Что значит «неси»: курьер, самовывоз, визит? | ✅ Default: внутренний курьер с полем цены и комментарием. | Операции / Логистика | До проектирования UX кнопки (Sprint 1) | Неправильный SLA доставки, конфликт ожиданий пользователя. | `blueprint.md` §3 сценарий 2 и §5 шаг 5. |
| D. «Неси» | 14. Источник адреса и стоимости доставки? | ✅ Default: адрес из профиля клиента; стоимость фиксированная (конфиг). | Продакт + Интеграции | До реализации заказа «Неси» (Sprint 1) | Заказы без адреса, неверная цена → ручные доработки. | `bitrix-integration.md` §2 (delivery) и `operating-notes.md` §4. |
| E. Returns | 15. Процесс возврата: этапы, кто создаёт RMA? | ✅ Default: v0.1 — только трекинг статусов; создание RMA в боте v0.2. | Операции + Продакт | До запуска сценария `/return` (Sprint 1) | Пользователи ожидают создание RMA, а бот не умеет. | `blueprint.md` §3 сценарий 4 и `bitrix-integration.md` §2/§3. |
| E. Returns | 16. Требуются ли фото/документы? | ✅ Default: до 3 фото, причина текстом обязательна. | Операции / Служба качества | До UX формы возврата (Sprint 1) | Отсутствие доказательств, споры по качеству. | `bitrix-integration.md` §2 (RMA) и `operating-notes.md` §2. |
| F. Observability | 17. Где хранятся логи/метрики и срок хранения? | ✅ Default: JSON в stdout, Prometheus `/metrics`, ретеншн 7–14 дней. | DevOps / SRE | До развертывания инфраструктуры (Sprint 0) | Нет трассировки инцидентов, нарушение требований безопасности. | `operating-notes.md` §2–§3. |
| F. Observability | 18. Сквозной `request_id` и трейсинг внешних вызовов? | ✅ Default: включить `X-Request-Id`, логировать латентность Bitrix. | DevOps / Backend | До реализации middleware (Sprint 1) | Невозможность расследовать ошибки, потеря контекста при ретраях. | `operating-notes.md` §2. |
| G. Security | 19. Настройка HMAC/секретов для вебхуков и хранение секретов? | ✅ Default: HMAC на вебхуках; секреты через GitHub Actions + .env на сервере. | Безопасность / DevOps | До подключения вебхуков (Sprint 0) | Утечки токенов, spoofing вебхуков. | `operating-notes.md` §5 и `bitrix-integration.md` §4. |
| G. Security | 20. Политика PII: что маскируем в логах? | ✅ Default: маскировать телефон/адрес, без PII в ошибках. | Безопасность / Legal | До запуска логирования (Sprint 0) | Нарушение 152-ФЗ/политик компании. | `operating-notes.md` §5. |
| H. Performance | 21. Целевой P95 API? | ✅ Default: P95 < 250 мс; поиск — потоковый/пагинируемый. | Backend / Продакт | До согласования SLA (Sprint 0) | Невозможно оценить ёмкость и выбор технологий. | `operating-notes.md` §1. |
| H. Performance | 22. Максимальный размер списков товаров/страниц? | ✅ Default: страница 20, жёсткий лимит 100 на запрос. | Продакт | До дизайна ответов (Sprint 1) | Риск превышения лимитов Telegram и Bitrix. | `blueprint.md` §3 и `operating-notes.md` §4. |
| I. Environments | 23. Какие среды: staging/prod, раздельные доступы? | ✅ Default: отдельные боты/токены для staging и prod, схема одинакова. | DevOps / Интеграции | Sprint 0 (до выдачи доступов) | Смешение данных, риски прод-утечек. | `operating-notes.md` §6. |
| I. Environments | 24. Кто владеет токенами и кто аппрувит прод? | ✅ Default: 1–2 maintainers, прод через PR-аппрув. | Техлид / Продакт | Sprint 0 | Нет ответственных за инциденты, хаос в релизах. | `operating-notes.md` §6 и `tools/specify/README.md`. |
| J. Errors | 25. Идемпотентные ключи при создании заказов? | ✅ Default: заголовок `Idempotency-Key`, дедуп 24 ч. | Backend / Интеграции | До разработки order flow (Sprint 1) | Дубли заказов и оплат. | `bitrix-integration.md` §1 и `operating-notes.md` §2. |
| J. Errors | 26. Политика ретраев (таймауты, backoff)? | ✅ Default: экспоненциальный backoff, макс 3 попытки с джиттером. | Backend / DevOps | Sprint 1 | Неконтролируемая нагрузка, пропущенные события. | `operating-notes.md` §1–§2. |
| K. Docs | 27. Где публикуем артефакты Spec Kit? | ✅ Default: исходник `tools/specify/`, зеркало `docs/spec/**`. | Продакт-документалист | Sprint 0 | Потеря актуальности знаний, проблемы с ревью. | `tools/specify/README.md`. |
| K. Docs | 28. Нумерация ADR/версий? | ✅ Default: ADR-0001 «Why Bitrix-first»; docs versioning v0.1 → v0.2. | Архитектор | Sprint 0 | ADR не синхронизированы, сложно отслеживать решения. | `tools/specify/README.md` и `docs/00‑Core — Синхронизация документации.md`. |

## Action Items
1. Назначить владельцев и подтвердить дедлайны по каждой строке — синк продакт + интеграции (до конца недели).
2. Собрать ответы от Bitrix-админа и логистики по п.1–7 и 13–14 на воркшопе (1 час, до старта Sprint 1).
3. Финансы/безопасность провести совместную сессию для п.11–12 и 19–20 (оформить в `operating-notes.md`).
4. DevOps/Backend подготовить драфт инфраструктуры и логирования (п.17–18, 23–26) — оформить ADR/Operating Notes обновления.
5. Документалист проставляет финальные ответы в указанные разделы Spec Kit и зеркалирует в `docs/spec/assistant-master/`.

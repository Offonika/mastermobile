# Конституция MasterMobile

Версия: 0.1 • Статус: черновик согласования

## Цель документа
- Зафиксировать общие правила, по которым развивается MasterMobile как middleware-продукт.
- Обеспечить единый источник истины для решений по архитектуре, документации и эксплуатации.
- Упростить онбординг новых участников и формализовать ответственность за изменения.

## Принципы
1. **Docs-first**: каждое изменение начинается с обновления или создания артефакта в `docs/` и только затем переходит в код/инфраструктуру.
2. **Единый контракт**: `openapi.yaml`, схемы БД и runbook-и всегда отражают фактическое состояние сервисов; несогласованные изменения запрещены.
3. **Прозрачность**: все обсуждения и решения фиксируются в PR/ADR, задачи сопровождаются ссылками на релевантные документы.
4. **Идемпотентность процессов**: поведение API, интеграций и пайплайнов не должно зависеть от повторного запуска; гарантия подтверждается тестами и документацией.
5. **Инциденты → улучшения**: после каждого инцидента обновляются runbook-и, NFR и тесты; повторение без обновления документации считается нарушением.

## Управление артефактами
Категории документов и ответственность:

| Категория | Примеры | Владелец |
| --- | --- | --- |
| Core/глоссарий | `docs/00‑Core — Синхронизация документации.md`, словарь статусов | Архитектура |
| Продуктовые документы | PRD, ONE-PAGER, SRS | Продакт-менеджеры потоков |
| Архитектура и интеграции | `docs/architecture/`, `docs/integrations/` | Архитекторы и лид интеграций |
| Обслуживание и эксплуатация | Runbook-и, NFR, Observability, Security | SRE/DevOps |
| Контракты и схемы | `openapi.yaml`, `docs/specs/`, `docs/testing/error_catalog.json` | Архитектура / API |

- Любой новый документ начинается с блока `Версия`/`Статус` и ссылки на связанные артефакты.
- Изменения фиксируются в changelog секциях профильных документов или в отдельном ADR.

## Процессы принятия решений
1. **Базовые изменения** (правки текста, обновление ссылок): PR с обязательным описанием, ссылка на задачу/issue, ревью владельца области.
2. **Функциональные изменения** (API, схемы, бизнес-логика): обсуждение на архитектурном стендапе, подготовка ADR или PRD/SRS обновления, синхронное обновление OpenAPI и тестов.
3. **Стратегические изменения** (новые потоки, пересмотр интеграций): инициатива через RFC в `docs/adr/`, обязательная валидация на steering-комитете и обновление карты `docs/00‑Core — Синхронизация документации.md`.

## Контроль качества
- **Перед PR**: `make lint`, `make typecheck`, `make test`, а также `make docs-ci` для документов.
- **Перед релизом**: smoke-тесты интеграций, сравнение `openapi.yaml` с запущенным сервисом, проверка миграций и seed-данных.
- **После релиза**: мониторинг ключевых метрик (`http_request_duration_seconds`, `integration_failures_total`, `queue_lag_seconds`) и анализ алертов.

## Обновление Конституции
- Ответственный: архитектурный комитет MasterMobile.
- Ревизия не реже одного квартала или по итогам крупных изменений в репозитории.
- Любые правки проходят через PR с согласованием владельцев всех категорий документов.
- В changelog указывается дата и краткое описание поправок.

## Связанные документы
- [README](../README.md) — быстрый старт и обзор.
- [00‑Core — Синхронизация документации](./00%E2%80%91Core%20%E2%80%94%20%D0%A1%D0%B8%D0%BD%D1%85%D1%80%D0%BE%D0%BD%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8.md) — карта статусов и зависимостей.
- [Architecture overview](./architecture/overview.md) — контекст и компоненты системы.
- [Runbook-и и NFR](./runbooks/README.md) — эксплуатационные инструкции.

ONE-PAGER — Переход 1С: УТ 10.3 → УТ 11 (без простоя)
Версия: 1.0 • Дата: 13.09.2025
Цель (v1 = 2–4 недели)
Надёжный обмен НСИ и документами между УТ 10.3 и УТ 11 при SoT = УТ 10.3 на старте.


Перевод ввода документов в УТ 11 по волнам, без простоя.


Интернет-магазин (1С-Битрикс) — на стандартном обмене с 1С (сейчас база-источник УТ 10.3; после cutover — УТ 11).


Scope
In (v1): КД3 (bulk НСИ), API-дельты (REST/JSON), «зеркало» ключевых документов, единый словарь статусов, идемпотентность, IntegrationLog/метрики, UAT/обучение.
 Out (v1): живой GPS-трек, авто-маршрутизация, ML, ЭДО/54-ФЗ/маркировка, серийники/IMEI/партии/сроки.
Архитектура (кратко)
УТ 10.3 ↔ Middleware (FastAPI) ↔ УТ 11 — НСИ/документы.


1С-Битрикс (сайт) ↔ 1С — стандартный обмен (CommerceML/REST), с переключением базы-источника на УТ 11 после cutover.


Надёжность: Idempotency-Key, X-Correlation-Id, очереди/backoff, IntegrationLog, health-чеки.


Матрица источника истины (SoT: старт → целевой)
Объект
SoT старт
SoT целевой
Ключи
Канал
Периодичность
Номенклатура
УТ 10.3
УТ 11 (волна 2)
GUID/SKU/штрих
КД3 + API
bulk + ≤60 с
Контрагенты
УТ 10.3
УТ 11 (2–3)
GUID/ИНН/тел
КД3 + API
bulk + ≤60 с
Склады/ед. изм.
УТ 10.3
УТ 11
GUID
КД3
bulk
Типы цен и цены
УТ 10.3
УТ 11 (волна 3)
код/валюта
КД3 + API
регл. + дельты
Ставки НДС
УТ 10.3
УТ 11 (после выверки)
код ставки
API
по изменению
Заказ клиента
10.3 → зеркало в 11
Мастер УТ 11 (3+)
№/GUID
API
≤60–120 с
Реализация / Поступление
10.3 → зеркало в 11
Мастер УТ 11 (после пилота)
GUID
API
≤120 с
Перемещение
УТ 10.3
УТ 11 (после пилота)
№/склады
API
≤120 с
Списание / Оприходование
УТ 10.3
УТ 11 (3+)
№/основание
API
≤120 с
Инвентаризация
УТ 10.3
УТ 11 (после «сухого» цикла)
№/склад
API
по акту
Возвраты (покуп./пост.)
УТ 10.3
УТ 11 (3+)
№/основание
API
≤120 с
ПКО / РКО / подотчёт
УТ 10.3
УТ 11 (после стаб.)
№/касса
API
по событию
Банк / эквайринг
УТ 10.3
УТ 11
№ платежа
API/файлы
дневной
Сайт ↔ 1С
УТ 10.3
УТ 11 (после cutover)
XML_ID/SKU
Стандартный обмен
регламентно

Мини-контракты API (v1)
POST /api/v1/ww/orders → создать заказ Walking Warehouse; 201 + order_id (идемпотентно по Idempotency-Key).


PATCH /api/v1/ww/orders/{orderId} → частичные правки (адрес, сумма, payload) без дублей.


POST /api/v1/ww/orders/{orderId}/status → смена статуса заказа; фото/гео остаются в Bitrix24 (передаём ссылки, без отдельного API).


План по волнам и ворота
W1 Подготовка (1 нед.): карта маппинга, КД3 bulk НСИ, MW-Core v1 → Gate: согласована SoT-матрица.


W2 Дельты + «зеркало» (1 нед.): дельты НСИ, зеркалирование заказов/док-тов 10.3→11, smoke-тесты → Gate: UAT без критичных.


W3 Пилот (1–2 нед.): часть ввода в УТ 11 (выбранные виды) → Gate: KPI недели достигнуты.


W4+ Промышленная: перевод мастера документов в УТ 11, отключение двойного ввода; переключение сайта на УТ 11.


RACI (сжато)
Owner/BA — Операции/IT · 1С (10.3/11) — интегратор 1С · MW-Core — бекенд · Bitrix CMS — веб-команда (стандартный обмен + cutover) · QA/DevOps — общие.
NFR / SLA
API MW p95 ≤ 400 мс (без внешних вызовов); таймаут к B24 — 10 с; ретраи ≤ 24 ч.
 Доступность MW ≥ 99,5% (рабочие часы); RPO ≤ 15 мин, RTO ≤ 2 ч.
 Логи JSON с correlation_id, маскирование ПДн; алерты: задержки дельт, 5xx/4xx, размер очередей.
KPI / UAT (v1)
НСИ p95 ≤ 60 с, документы ≤ 120 с; точность НСИ ≥ 99,5% (акт сверки).
 0 дублей на 1000 модифицирующих вызовов (идемпотентность).
 Задача B24 по «Готов» ≤ 10 с; instant-order подтверждён в 1С ≤ 3 мин.
 ПКО-черновик корректен (разделение товар/доставка, НДС).
Стыковка со стримом «Ходячий склад / Рюкзак»
Общий MW и логирование (единые Idempotency-Key/X-Correlation-Id).


Совместно используемые справочники: номенклатура, контрагенты, склады.


Договорённости по SoT: основной складской учёт — Stream-A; оперативный журнал «рюкзака» — Stream-B.


Общие «ворота» на cutover: 2 недели стабильных дельт + акт сверки «0 расхождений».



Глоссарий (для нетехнарей)
УТ 10.3 / УТ 11 — версии 1С «Управление торговлей» (старая и новая).


SoT (Source of Truth) — система-источник «истинных» данных (где правда).


КД3 — «Конвертация данных 3.0» (типовой механизм 1С для разовой/массовой выгрузки).


API / REST / JSON — программный интерфейс обмена данными; стиль REST; формат сообщений JSON.


Middleware (MW) — промежуточный сервис-шлюз между системами (в нашем случае — FastAPI).


Idempotency-Key — уникальный ключ запроса, чтобы повтор не создавал дубликаты.


X-Correlation-Id — идентификатор цепочки действий для сквозной трассировки в логах.


IntegrationLog — журнал интеграции (записи всех обменов/ошибок).


Cutover — момент переключения «мастера»/источника (например, сайта) на новую базу.


UAT — приёмочные испытания пользователями (User Acceptance Testing).


NFR / SLA — нефункциональные требования (скорость/надёжность) и целевые уровни сервиса.


RPO / RTO — максимально допустимая потеря данных / время восстановления после сбоя.


p95 — 95-й перцентиль (скорость для 95% запросов).


CommerceML — стандарт обмена данными 1С ↔ интернет-магазин.


ПКО / РКО — приходный / расходный кассовый ордер.


SKU / GUID — артикул товара / глобальный уникальный идентификатор.


Bitrix24 / 1С-Битрикс (сайт) — CRM/задачи/моб.приложение и CMS интернет-магазина соответственно.


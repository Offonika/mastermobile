---
title: "Bitrix24 call registry CSV schema"
version: "v0.1.0"
description: >-
  Data dictionary for the `registry/calls_<from>_<to>.csv` artifact produced by the
  Bitrix24 call transcription pipeline. The schema ensures downstream analysts receive
  consistent metadata about each processed call and can reconcile records with the
  middleware state and exported transcripts.
encoding: "UTF-8"
delimiter: ";"
retention_policy:
  csv_days: 365
  transcripts_days: 180
  raw_audio_days: 90
  notes: >-
    Retention follows ยง9 00-Core: call registry CSV kept 365 days for finance audits;
    transcripts retained 180 days, raw audio 90 days before archival or purge.
source_of_truth:
  database_tables:
    - name: call_exports
      description: >-
        Tracks each export run (`run_id`, period range, actor, status). `run_id` joins
        call records and is exported for traceability.
    - name: call_records
      description: >-
        Stores one row per Bitrix24 record (`run_id`, `call_id`, `record_id`,
        metadata, processing status, cost, retry counters). Primary keys surface in
        the CSV to maintain idempotency and reconciliation with storage artifacts.
  artifacts:
    - name: exports/<period>/transcripts/
      relation: transcript_path
      description: UTF-8 text transcripts linked from each CSV row.
    - name: exports/<period>/summary/
      relation: summary_path
      description: Optional call summaries (Markdown) emitted when the feature flag is enabled.
fields:
  - name: run_id
    type: uuid
    required: true
    description: Identifier of the export execution that produced the row.
    source:
      table: call_records
      column: run_id
    examples:
      - "8c9c2cb4-5a37-4b7d-8c29-6c5d9ec470b9"
  - name: call_id
    type: string
    required: true
    description: Call identifier returned by Bitrix24 (`CALL_ID`).
    source:
      table: call_records
      column: call_id
    examples:
      - "721459"
  - name: record_id
    type: string
    required: true
    description: Recording identifier returned by Bitrix24 (`RECORD_ID`).
    source:
      table: call_records
      column: record_id
    examples:
      - "5654f1b3d2"
  - name: datetime_start
    type: datetime
    format: RFC3339
    timezone: Europe/Moscow (export uses source timezone with offset)
    required: true
    description: Call start timestamp from Bitrix24.
    source:
      table: call_records
      column: started_at
    examples:
      - "2025-08-31T19:23:45+03:00"
  - name: direction
    type: enum
    required: true
    description: Direction of the call relative to the contact center.
    allowed_values:
      - inbound
      - outbound
      - internal
    source:
      table: call_records
      column: direction
    examples:
      - "inbound"
  - name: from
    type: string
    required: true
    description: Normalized caller number (E.164, Bitrix24 `PHONE_NUMBER`).
    pii: true
    source:
      table: call_records
      column: from_number
    examples:
      - "+74951234567"
  - name: to
    type: string
    required: true
    description: Normalized callee number (E.164 or internal extension).
    pii: true
    source:
      table: call_records
      column: to_number
    examples:
      - "+79997654321"
  - name: duration_sec
    type: integer
    required: true
    description: Total duration of the call in seconds (Bitrix24 `DURATION`).
    source:
      table: call_records
      column: duration_sec
    examples:
      - 420
  - name: recording_url
    type: string
    required: true
    description: HTTPS URL to the Bitrix24 recording used for traceability.
    source:
      table: call_records
      column: recording_url
    examples:
      - "https://b24.example.com/telephony/record/5654f1b3d2.mp3"
  - name: transcript_path
    type: string
    required: true
    description: Relative path to the UTF-8 transcript file inside `exports/<period>/transcripts/`.
    source:
      table: call_records
      column: transcript_path
    examples:
      - "transcripts/call_721459.txt"
  - name: transcription_cost
    type: number
    format: decimal(10,2)
    required: true
    description: Total recognition cost in billing currency (rounded up by minute as per pricing).
    source:
      table: call_records
      column: transcription_cost
    examples:
      - 18.00
  - name: currency_code
    type: string
    required: true
    description: ISO-4217 currency code for the transcription cost.
    source:
      table: call_records
      column: currency_code
    examples:
      - "RUB"
  - name: language
    type: string
    required: true
    description: ISO 639-1 language detected for the transcript.
    source:
      table: call_records
      column: language
    examples:
      - "ru"
  - name: status
    type: enum
    required: true
    description: Processing status of the call within the export run.
    allowed_values:
      - completed
      - transcription_pending
      - error
    source:
      table: call_records
      column: status
    examples:
      - "completed"
  - name: error_code
    type: string
    required: false
    description: Machine-readable code when `status = error` (e.g. `missing_audio`, `transcription_timeout`).
    source:
      table: call_records
      column: error_code
    examples:
      - "missing_audio"
  - name: retry_count
    type: integer
    required: false
    description: Number of retry attempts performed by the pipeline.
    source:
      table: call_records
      column: attempts
    examples:
      - 2
  - name: checksum
    type: string
    required: false
    description: Hex-encoded checksum of the stored audio/transcript pair for QA sampling.
    source:
      table: call_records
      column: checksum
    examples:
      - "4f5d6a7b8c9d10e1"
  - name: summary_path
    type: string
    required: false
    description: Relative path to optional Markdown summary (`exports/<period>/summary/`).
    source:
      table: call_records
      column: summary_path
    examples:
      - "summary/call_721459.md"
notes:
  - Field order in the CSV matches the sequence defined above.
  - Semicolon (`;`) delimiter chosen for compatibility with European Excel locale settings.
  - Numeric fields use dot (`.`) as decimal separator; no thousands separators permitted.
  - Headers must be included on the first row and remain stable for automated ingestion.

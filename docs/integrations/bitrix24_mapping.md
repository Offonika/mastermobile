# Маппинг интеграции с Bitrix24

## Сущности
- **Лиды** → `crm.leads`
  - Поля: `external_id`, `title`, `status`, `assigned_user_id`, `source`.
  - При конверсии лида создаётся сделка в `crm.deals` с ссылкой на исходный `lead_id`.
- **Сделки** → `crm.deals`
  - Поля: `pipeline_id`, `stage_code`, `budget_amount`, `company_id`.
  - Кастомные поля B24 `UF_CRM_*` маппятся в JSON-блок `custom_attributes`.
- **Звонки телефонии** → `telephony.call_logs`
  - Поля: `call_id`, `direction`, `duration_sec`, `recording_url`.
  - Дополнительно создаётся событие в `analytics.voice_events` для последующей расшифровки.
- **Задачи** → `work.tasks`
  - Поля: `title`, `description`, `responsible_id`, `deadline_at`, `tags[]`.
  - Проставляем связь с проектом по `group_id`, если он присутствует в событии Bitrix24.

## Ограничения/квоты
- REST-квота: не более 2 запросов в секунду и 120 запросов в минуту на одно приложение; используем очередь с троттлингом.
- Ежедневное ограничение на выгрузку звонков — 10 000 записей, при превышении переносим обработку на следующий день.
- Храним только последние 90 дней истории задач, архивируем более старые данные в объектное хранилище.
- Размер одного события не должен превышать 8 МБ, большие записи разбиваются на чанки и собираются воркером.

# ADR-0002: Целевые SLO по латентности API

- **Статус:** Accepted
- **Дата:** 2025-09-30
- **Область:** Observability / NFR

## Контекст
- Метрики латентности p95 фиксировались с разными целями в документах `00‑Core`, `NFR` и `Observability`, что создавало противоречия при расчёте бюджетов ошибок и настройке алертов.
- Владельцы NFR (архитектура) и Observability (SRE) инициировали синк 30.09.2025, чтобы согласовать единые целевые показатели для всех потоков API.
- Интеграционные команды (Core Sync, Walking Warehouse) ориентируются на p95 при планировании capacity и тестов, поэтому расхождения приводили к разным ожиданиям по производительности.

## Решение
- Для всех HTTP API middleware зафиксированы цели p95: **чтение ≤ 250 мс**, **модифицирующие операции ≤ 400 мс**.
- Цель применяется к усреднённым 5-минутным окнам на уровне маршрута (`method + normalized route`).
- Метрики считаются на стороне ingress/gateway, включая сетевой overhead middleware.
- Alerting и error-budget отчёты используют те же пороги и ссылаются на данный ADR.

## Последствия
- Документы `00‑Core — Синхронизация документации`, `NFR — MasterMobile Middleware`, `observability.md` должны ссылаться на этот ADR и содержать идентичные значения p95.
- Нагрузочные тесты и capacity planning обновлены: ориентир — 200 RPS чтение, 120 RPS запись при соблюдении p95.
- Команды Core Sync и Walking Warehouse уведомлены в канале `#mm-observability` о новых целевых значениях и необходимости обновить алерты.

## Альтернативы
- Сохранить более жёсткие цели (150/250 мс) — признано нереалистичным без оптимизаций в очередях 1С и дополнительных реплик.
- Сохранить прежние 400/700 мс — увеличивает риск деградации UX мобильных клиентов и расходует error budget слишком быстро.

## Follow-up
- Провести пересмотр p99 после запуска новой очереди событий (до 31.10.2025).
- Обновить нагрузочные сценарии в `tests/load/` после появления симуляторов API.

# ONE-PAGER — «Тексты всех звонков за 60 дней из Bitrix24»

> **Версия:** v1.1.0  \
> **Дата обновления:** 2025-09-14  \
> **Статус:** Draft  \
> **Владелец:** Stream «B24 Transcribe» (Интеграции)  \
> **Связанные артефакты:** [PRD — Тексты звонков Bitrix24](../PRD%20—%20Тексты%20звонков%20Bitrix24.md), [SRS — Тексты звонков Bitrix24 (выгрузка за 60 дней)](../SRS%20—%20Тексты%20звонков%20Bitrix24%20(выгрузка%20за%2060%20дней).md), [Runbook: экспорт звонков](../runbooks/call_export.md), [Calls CSV schema](../specs/call_registry_schema.yaml)

## Changelog

- 2025-09-14 — v1.1.0: перемещено в `docs/b24-transcribe/`, добавлен блок версионирования и связи с артефактами.
- 2024-08-01 — v1.0.0: исходная версия ONE-PAGER (внутренний релиз).

## Зачем
- Быстро собирать тексты всех звонков за последние 60 дней.
- Подготовить данные для дальнейшего анализа в ChatGPT: поиск проблем, выявление тем и возражений, корректировка скриптов, фиксация "следующих шагов".

## Что получим на выходе
- **Папка с текстами** — по одному файлу на звонок (`call_12345.txt`).
- **Реестр звонков** (`calls.csv`) с колонками: дата и время, кто звонил и кому, длительность, ссылка на запись, путь к расшифровке, стоимость распознавания.
- **Короткий отчёт** с суммарной длительностью и итоговой стоимостью распознавания.

## Как это работает
1. Считываем список звонков за последние 60 дней из Bitrix24 (телефония и записи должны быть доступны).
2. Скачиваем аудиозаписи всех найденных звонков.
3. Распознаём речь при помощи выбранного сервиса (по умолчанию OpenAI Whisper, ориентировочная стоимость — $0,006 за минуту аудио).
4. Сохраняем тексты звонков и формируем таблицу-реестр.
5. *(Опционально)* Генерируем краткие саммари и набор тегов для быстрого обзора.

## Что нужно от заказчика
- Доступ к Bitrix24 с правами чтения истории звонков и ссылок на записи.
- Период обработки: по умолчанию последние 60 дней, можно указать другой диапазон дат.
- Подтверждение выбранного сервиса распознавания (если предпочтений нет — используем Whisper).
- Корпоративный прокси для ChatGPT/Whisper: `http://user150107:dx4a5m@102.129.178.65:6517` (прописывается в `.env` как `CHATGPT_PROXY_URL`).

## Контроль качества
- Проверяем случайную выборку ~50 файлов на читаемость, пунктуацию и язык распознавания.
- Сверяем суммарные минуты в реестре с показателями Bitrix24, чтобы подтвердить расходы.
- Повторный запуск не создаёт дублей: недокачанные записи автоматически догоняются при следующем запуске.

## Стоимость
- Итоговая сумма рассчитывается как общая длительность всех звонков (в минутах) × цена сервиса за минуту.
- Пример: 9 000 минут → Whisper ≈ $54 (точная сумма указывается в итоговом отчёте).

## Риски и как их закрываем
- **Битые ссылки или отсутствие записи.** Помечаем такие случаи, повторяем попытку загрузки; в отчёте видно, что пропущено.
- **Лимиты Bitrix24.** Забираем звонки порциями, чтобы не упереться в ограничения API.
- **Большой объём.** Запускаем пакетную и параллельную обработку, чтобы ускорить процесс.

## Дальнейшие шаги
1. Получаем доступы и подтверждение дат.
2. Запускаем обработку: формируем папку с текстами, реестр и короткий отчёт.
3. *(Опционально)* Настраиваем шаблоны для ChatGPT:
   - «Сделай краткое резюме звонка».
   - «Выдели возражения/темы/следующие шаги».
   - «Сформируй чек-лист улучшений скрипта продаж».

## UAT-чеклист
- Покрытие: в `calls.csv` и папке `transcripts/` присутствует ≥ 99% звонков с доступными аудиозаписями за выбранный период.
- Расшифровки: для ≥ 99% звонков сформированы файлы `call_<id>.txt`, проверка выборки из 50 файлов подтверждает читабельность и корректный язык.
- Сверка длительности: суммарные минуты из `calls.csv` расходятся с отчётом Bitrix24 не более чем на 0,5%.
- Дубли: повторный запуск по тому же периоду не создаёт повторных записей в `calls.csv` и `transcripts/`.
- Отчёт: итоговый `summary_<period>.md` содержит общую длительность, стоимость и перечень исключений/ошибок.

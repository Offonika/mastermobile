# Threat Model (draft)

## Authentication
- JWT Bearer токены со scope/role-клеймами.
- Минимальный TTL, обязательный `exp`, `iat`, `iss`, `aud`.
- Ротация refresh-токенов и отзыв украденных access-токенов.
- Request/trace-id для корреляции и расследований.

## Authorization (RBAC)
- Модель ролей и разрешений построена по принципу наименьших привилегий.
- Роли привязаны к утверждённым бизнес-действиям; запрещён доступ по умолчанию.
- Контроль доступа проверяется на каждом запросе: scope + роль + атрибуты сущности.
- Журнал действий фиксирует роль, объект, результат и контекст запроса.
- Политики пересматриваются при каждом изменении бизнес-процессов (security review).

## CORS Policy
- Разрешены только доверенные origin (allow-list), wildcard запрещён.
- Preflight-запросы валидируются и кешируются с минимальным TTL.
- К заголовкам и методам применяется allow-list; произвольные заголовки блокируются.
- В проде CORS отключается для публичных API, если интеграции идут сервер-сервер.

## Rate Limiting для модифицирующих ручек
- Отдельные лимиты для `POST/PUT/PATCH/DELETE`, строже, чем для чтения.
- Лимиты привязаны к пользователю, клиентскому приложению и IP (multi-dimensional).
- Поддержка глобального аварийного рубильника (веб-консоль / feature flag).
- Результат rate-limit событий логируется и мониторится (оповещения SIEM/SOC).
- Комбинируется с `Idempotency-Key`, чтобы исключить повторную обработку при ретраях.

## Webhook Signature Verification
- Подписываем полезную нагрузку HMAC (SHA-256) с уникальным секретом на клиента.
- Верифицируем заголовки `X-Signature`, `X-Request-Timestamp`, `X-Request-Id`.
- Запрос отклоняется, если таймстамп старше допустимого окна (±5 минут).
- Проверяем одноразовость `X-Request-Id` (replay protection в хранилище). 
- Источник проверяется по allow-list IP/ASN и TLS-пину.
- Подписи и метаданные журналируются; подозрительные события отправляются в SIEM.

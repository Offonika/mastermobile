ONE-PAGER (v1.3, Ходячий склад)
Дата: 17.09.2025
Что мы делаем
Запускаем прозрачный процесс курьерской доставки и возвратов без больших переделок в 1С 10.3.
Курьер — мобильный Bitrix24 (наш виджет).


Менеджер — 1С.


«Рюкзак курьера» = мини-склад для допродаж «с места» + зона возвратов.


Возвраты через курьера подтверждает менеджер мастером в 1С (без новых типов документов).



Как это работает (по шагам)
Доставка
Менеджер в 1С нажимает «Отправить в B24 (курьер)».
 → ~10 с и у курьера задача в B24, в 1С статус «Готов (B24)».
 → Перемещений «на заказ» не создаём.


Курьер приезжает, сканирует QR заказа (товары уже собраны; скан штрихкодов — при необходимости/для дорогих или серийных товаров).


Курьер выдаёт заказ, фиксирует наличные, делает фото.


Конец смены: сдаёт наличку.
 — Сумма уже в «Деньги в пути — <Подразделение>» (долг клиента закрыт при приёме оплаты).
 — Раз в день: одним документом перенос «Деньги в пути → Касса подразделения».


Рюкзак курьера (движения только по делу)
«Положить в рюкзак» (штучный товар для допродажи) → Перемещение: База → Склад курьеров — <Подразделение>.


«Допродажа из рюкзака» → Реализация со Склада курьеров (не перемещение).


«Возврат остатка» (конец смены) → Перемещение: Склад курьеров → База (свёрткой, один документ на смену/курьера).



Возврат (строго по продаже, без новых документов)
Правила:
Принимаем возврат только если найдена исходная реализация.


Возврат — только online (без сети кнопка недоступна).


Курьер не принимает товар, если продажи нет — вежливый отказ.


Через курьера
В виджете: «Принять возврат» → скан штрихкода/IMEI → выбрать Качество (новый/брак) и Причину, сделать фото.


MW валидирует и, если ОК, фиксирует событие return_ready. Товар у курьера уходит в «ячейку Возвраты» (не для продажи) до сдачи на базе.


Через менеджера (КПП-4) — мастер возврата (внешняя обработка)
Менеджер запускает мастер.


Мастер серверно находит реализацию (IMEI/серия → заказ → контрагент+SKU, без доступа к чужим журналам).


Сразу создаёт стандартный документ «Возврат товаров от покупателя» (черновик) на основании реализации: строки, цены/НДС, серия/IMEI, Качество/Причина.


Антидубли: к возврату только доступный остаток по каждой строке.


Менеджер проводит черновик при приёмке на базе:


Качество=«новый» → товар на склад возвратов/дальше по политике.


Качество=«брак» → на Склад «Карантин/Возвраты» (проверка).


Если брак НЕ принят (по результатам проверки) — уточнение:
Черновик не проводим и удаляем/отклоняем (в 1С движений не было и нет).


В MW ставим статус return_rejected, клиенту уходит уведомление «Возврат не одобрен: {причина}».


В B24 создаётся подзадача «Вернуть товар клиенту» (адрес/контакт/дедлайн).


Курьер возвращает товар, фиксирует фото «передачи обратно», задача закрывается.



Деньги и возвраты денег
Клиентские наличные: при приёме у курьера — в «Деньги в пути — <Подразделение>»; в конце дня — пакетный перенос в кассу.


Возвраты денег клиенту: только безналично, централизованно бухгалтерией после проведения документа возврата.


Наличный возврат у двери — выключен (можно включить позже по роли/лимиту).



QR и штрихкоды
Заказ: QR печатается при «Готов (B24)» (order_id, сумма, контроль).


Товары: скан штрихкода/IMEI — для проверки состава и для возвратов.


Нет кода → ручной ввод + обязательное фото.



Роли и доступы (уточнение)
Кнопка «Отправить в B24» и мастер возврата — только у менеджера (роль).


Курьер видит и обрабатывает только свои задачи/возвраты.


Привилегированный поиск реализации — серверный, без открытия чужих журналов.



Уведомления клиенту
«Заказ №{N} передан курьеру. К оплате: {sum} ₽».


«Курьер в пути. Покажите QR-код при получении».


«Получение подтверждено. Принято {paid} ₽. Остаток: {rest} ₽».


«Возврат принят. Сумма к возврату: {sum} ₽. Деньги будут возвращены безналично».


При отказе по браку: «Возврат не одобрен: {причина}. Товар будет возвращён {доставим/выдача на базе}.»



Контроль и отчёты
«Рюкзак курьера» — остатки и допродажи.


«Возвраты в пути» — что у курьеров, не принято на базе (по событиям MW/черновикам).


«Возвраты принятые» — проведённые документы в 1С.


Сверка «Деньги в пути» ↔ касса.


Алерты/метрики (уточнение):


создание задачи курьеру и уведомления клиенту после return_rejected — ≤ 60 с (p95);


возвраты в статусе return_ready старше 1 дня — эскалация.



Что входит в v1 (2–3 недели)
1С: кнопка «Отправить в B24 (курьер)», авто-статус «Готов (B24)», поля заказа, TaskIdB24; склады курьеров; движения по рюкзаку; внешняя обработка (мастер возврата), создающая стандартный «Возврат товаров от покупателя» (черновик).


Middleware: интеграция 1С↔B24, события возвратов, return_rejected/уведомления/подзадача «Вернуть клиенту», защита от дублей, очереди/ретраи, логи.


Bitrix24: задачи с полями/фото, подзадача «Вернуть товар клиенту», ссылка на виджет.


Виджет: скан QR/штрихкодов, фото «забрал/отдал/сдача/возврат», оффлайн (кроме возврата), экран «Принять возврат» и «Вернуть клиенту».



Как поймём, что всё работает
«Готов → Отдан» — быстрее на 20%.


≥95% доставок без возврата.


Допродажи из рюкзака +7–15%.


Разница по наличным ≤ 0,3%.


Точность остатков рюкзака ≥98%.


Возвраты: return_ready → проведено ≤ 1 раб. дня; rejected → задача курьеру создана и закрыта, движений в 1С нет.


# Storage retention and cleanup

## Purpose

Автоматический сервис хранения (локально и в S3) содержит записи звонков, транскрипты
и краткие саммари. Чтобы выполнять требования по защите данных и не переполнять
диски/бакеты, приложение периодически удаляет устаревшие артефакты.

## Конфигурация

| Переменная | Назначение | Значение по умолчанию |
| --- | --- | --- |
| `RAW_RECORDING_RETENTION_DAYS` | Срок хранения исходных mp3-файлов в `raw/`. | 90 |
| `TRANSCRIPT_RETENTION_DAYS` | Срок хранения транскриптов (`transcripts/`). | 180 |
| `SUMMARY_RETENTION_DAYS` | TTL Markdown-саммари (`summaries/`). | 365 |
| `STORAGE_CLEANUP_INTERVAL_HOURS` | Периодичность фоновой очистки. | 24 |

Все значения можно переопределить в `.env`. Ноль отключает удаление конкретной
категории.

## Механика очистки

1. При запуске FastAPI-приложения создаётся фоновая задача `storage-cleanup`.
2. Задача запускает `StorageService.cleanup_expired_assets()` и удаляет объекты,
   чей возраст превышает заданный TTL.
3. Локальные каталоги (`raw/`, `summaries/`, `transcripts/`) сканируются рекурсивно;
   пустые директории удаляются.
4. Для S3-бакетов обходятся префиксы `raw/` и `summaries/` с использованием
   `ListObjectsV2` + `DeleteObject`.

Ошибки удаления логируются, но не прерывают следующую итерацию цикла.

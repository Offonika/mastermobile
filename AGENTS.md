# AGENTS.md

## üßë‚Äçüíª –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Codex –∏ –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä–æ–≤

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî –æ–±—â–∏–π –¥–ª—è –¥–≤—É—Ö –ø–æ—Ç–æ–∫–æ–≤: **¬´–•–æ–¥—è—á–∏–π —Å–∫–ª–∞–¥ (Walking Warehouse)¬ª** –∏ **Core Sync (1–°: –£–¢ 10.3 ‚Üî –£–¢ 11)**. –ó–¥–µ—Å—å –∂–∏–≤—É—Ç Middleware (FastAPI), –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã API v1, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bitrix24 –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã.  
–í —Ñ–∞–π–ª–µ –æ–ø–∏—Å–∞–Ω–æ, –∫–∞–∫ –∞–≥–µ–Ω—Ç Codex (–∏ –ª—é–±–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫) –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–æ–¥–æ–≤–æ–π –±–∞–∑–æ–π: –∑–∞–ø—É—Å–∫, —Ç–µ—Å—Ç—ã, –ª–∏–Ω—Ç–∏–Ω–≥, –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –∏ –≥–¥–µ –∏—Å–∫–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ.

**–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏** (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏):  
- **API‚ÄëContracts v1.1.3 ‚Äî Unified**  
- **SRS Core Sync v1.0.1** / **PRD Core Sync v1.1.1**  
- **SRS ¬´–ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞¬ª v0.3** / **PRD ¬´–•–æ–¥—è—á–∏–π —Å–∫–ª–∞–¥¬ª v1.3.1**  
- **ER + DDL v0.6.4 ‚Äî Unified (PostgreSQL 14+)**  
- **00‚ÄëCore v1.3** (Core‚ÄëAPI‚ÄëStyle, Status‚ÄëDictionary, Metrics/Alerts, Retention, Envs/Flags)

---

## üìê –ü—Ä–∞–≤–∏–ª–∞ Codex (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∏ —Ç–µ—Å—Ç—ã
- –ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ –Ω–∏–∂–µ **85‚ÄØ%** (`pytest --cov`, `--cov-fail-under=85`).
- –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –ø—É–±–ª–∏—á–Ω—ã–π endpoint/handler/use‚Äëcase –∏–º–µ–µ—Ç unit‚Äë—Ç–µ—Å—Ç –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π —Ç–µ—Å—Ç.
- –¢–µ—Å—Ç—ã –ª–µ–∂–∞—Ç –≤ `tests/` –∑–µ—Ä–∫–∞–ª—å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø–∞–∫–µ—Ç–æ–≤; –∏—Å–ø–æ–ª—å–∑—É–µ–º `pytest`, `pytest-asyncio`, `httpx.AsyncClient`, `respx`/`pytest-respx` –¥–ª—è –º–æ–∫–æ–≤ HTTP (Bitrix24/1–°), `fakeredis` –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π.
- –ö—Ä–∞–π–Ω–∏–µ —Å–ª—É—á–∞–∏: –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–ø–æ–≤—Ç–æ—Ä —Å –∏–Ω—ã–º —Ç–µ–ª–æ–º ‚Üí 409), –ª–∏–º–∏—Ç—ã (429), —Ç–∞–π–º–∞—É—Ç—ã (504), offline‚Äë—Ä–µ–ø–ª–µ–π, —Ä–∞—Å—á—ë—Ç—ã —Å—É–º–º/–ù–î–°/–æ–∫—Ä—É–≥–ª–µ–Ω–∏–π.

### –¢–∏–ø–∏–∑–∞—Ü–∏—è
- –ó–∞–ø—É—Å–∫–∞–µ–º `mypy --strict` –¥–ª—è –≤—Å–µ–≥–æ Python‚Äë–∫–æ–¥–∞.
- –ü—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é (–≤–∫–ª—é—á–∞—è `-> None`).
- `Any` –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–∫—Ä–æ–º–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç —Å `# type: ignore[...]/# noqa: ANN401`).

### –°—Ç–∏–ª—å
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: **Black** (—Å—Ç—Ä–æ–∫–∏ ‚â§‚ÄØ88), –ª–∏–Ω—Ç–µ—Ä: **ruff** (`ruff check .`).
- –ò–º–ø–æ—Ä—Ç—ã: stdlib ‚Üí —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ ‚Üí –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ; –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã.
- –õ–æ–≥–≥–µ—Ä –≤ –º–æ–¥—É–ª—è—Ö: `logger = logging.getLogger(__name__)`.

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã API
- **–ï–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç**: API‚ÄëContracts v1.1.3.  
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏: `make check-openapi` (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è OpenAPI, –ø—Ä–∏–≤—è–∑–∫–∞ status/enum, problem+json).  
- –î–ª—è –≤—Å–µ—Ö –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ `Idempotency-Key` (TTL 72—á, `(key, endpoint, actor_id)`), –∑–∞–≥–æ–ª–æ–≤–∫–∏ `X-Correlation-Id`, `X-Api-Version`.

### –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å/–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –õ–æ–≥–∏ JSON —Å `correlation_id`; –ü–î–Ω (—Ç–µ–ª–µ—Ñ–æ–Ω/–∞–¥—Ä–µ—Å/—Å—É–º–º—ã) ‚Äî –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å.
- –ú–µ—Ç—Ä–∏–∫–∏/–∞–ª–µ—Ä—Ç—ã ‚Äî –ø–æ 00‚ÄëCore: –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–µ–ª—å—Ç, %5xx/%4xx, —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π, –¥—É–±–ª–∏–∫–∞—Ç—ã/1000 POST.

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- JWT (access 15 –º–∏–Ω, refresh 7 –¥–Ω–µ–π), JWKS‚Äë—Ä–æ—Ç–∞—Ü–∏—è ‚â§90 –¥–Ω, clock‚Äëskew ‚â§30—Å.
- **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ/—Ñ–∞–π–ª—ã –≤ –ë–î ‚Äî —Ç–æ–ª—å–∫–æ ID Bitrix24 Disk.
- Webhooks –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è `X-Webhook-Signature: sha256=HMAC_SHA256(body, secret)`, –æ–∫–Ω–æ ¬±5 –º–∏–Ω.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏
- HTTP‚Äë–∫–ª–∏–µ–Ω—Ç—ã, –ë–î‚Äë—Å–µ—Å—Å–∏–∏ –∏ —Ñ–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –∑–∞–∫—Ä—ã–≤–∞—Ç—å (`async with`/`with`).
- –í —Ç–µ—Å—Ç–∞—Ö ‚Äî –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–æ–≤/—Ñ–∏–∫—Å—Ç—É—Ä—ã; –Ω–∏–∫–∞–∫–∏—Ö —É—Ç–µ—á–µ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

### –õ–æ–∫–∞–ª—å–Ω—ã–π CI –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
- `make ci` –∏–ª–∏: `pytest -q --cov && mypy --strict . && ruff check . && make check-openapi`  
–ö–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ–±—è–∑–∞–Ω –±—ã—Ç—å `0`.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

- **apps/mw/** ‚Äî Middleware (FastAPI, –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞)
  - `api/` ‚Äî —Ä–æ—É—Ç–µ—Ä—ã v1 (`/nsi`, `/docs`, `/cash`, `/sync`, `/tasks`, `/returns`)
  - `domain/` ‚Äî use‚Äëcases, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
  - `infra/` ‚Äî –∫–ª–∏–µ–Ω—Ç—ã Bitrix24/1C, –æ—á–µ—Ä–µ–¥–∏ (Redis), –ë–î (SQLAlchemy)
  - `schemas/` ‚Äî Pydantic‚Äë—Å—Ö–µ–º—ã, OpenAPI –∏—Å—Ç–æ—á–Ω–∏–∫–∏
  - `settings.py` ‚Äî –∫–æ–Ω—Ñ–∏–≥
- **db/** ‚Äî SQL‚Äë–º–∏–≥—Ä–∞—Ü–∏–∏ (`v0.6.1` ‚Üí `v0.6.4`), —Å–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **contracts/** ‚Äî OpenAPI/JSON Schema, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
- **infra/docker/** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (mw, postgres, redis), `docker-compose.yml`
- **scripts/** ‚Äî —É—Ç–∏–ª–∏—Ç—ã (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π, –∑–∞–≥—Ä—É–∑–∫–∞ UF‚Äë–ø–æ–ª–µ–π B24)
- **tests/** ‚Äî –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã (—é–Ω–∏—Ç/–∫–æ–Ω—Ç—Ä–∞–∫—Ç/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ)

---

## üöÄ –ó–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ / Docker / Codex)

### –õ–æ–∫–∞–ª—å–Ω–æ
```bash
python -V  # >=3.11
make venv && source .venv/bin/activate
cp infra/env/.env.example .env  # –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è
make run  # –∑–∞–ø—É—Å–∫–∞–µ—Ç FastAPI –Ω–∞ http://localhost:8000
```

### Docker / Compose
```bash
docker compose up -d postgres redis
docker compose up mw  # –±–∏–ª–¥ –∏ –∑–∞–ø—É—Å–∫ middleware
```

### –ü–æ–ª–µ–∑–Ω—ã–µ Make‚Äë—Ü–µ–ª–∏
```bash
make ci             # —Ç–µ—Å—Ç—ã+–ª–∏–Ω—Ç–µ—Ä—ã+–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
make test           # pytest —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make lint           # ruff + black --check
make typecheck      # mypy --strict
make check-openapi  # –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤/—Å—Ö–µ–º
make load-devdata   # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏/UF –ø–æ–ª—è
```

---

## üß™ –¢–µ—Å—Ç—ã –∏ –∫–∞—á–µ—Å—Ç–≤–æ

- **–Æ–Ω–∏—Ç/Async:** `pytest -q --cov` (+ `pytest-asyncio`).
- **HTTP‚Äë–º–æ–∫–∏:** `respx` + `httpx.AsyncClient` –¥–ª—è Bitrix24/1–°.
- **–û—á–µ—Ä–µ–¥–∏:** `fakeredis` –¥–ª—è —Ä–µ—Ç—Ä–∞–µ–≤/backoff.
- **–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã:** —Å—Ö–µ–º–∞—Ç–µ—Å—Ç—ã –Ω–∞ —Å—Ö–µ–º—ã –∏–∑ `contracts/` (–µ–≤–∞–ª–∏–¥–∞—Ç–æ—Ä OpenAPI, problem+json, —Å—Ç–∞—Ç—É—Å‚Äë–º–∞–ø–ø–∏–Ω–≥).
- **–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:** 409 –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (–ø–æ–≤—Ç–æ—Ä —Å –∏–Ω—ã–º —Ç–µ–ª–æ–º), 429 rate limit, 504 upstream timeout, 413 upload‚Äëlimit, 401/403.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞:
```bash
pytest -q --cov --cov-fail-under=85
mypy --strict apps/mw
ruff check apps/mw tests
```

---

## üõ†Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–ú–∏–Ω–∏–º—É–º –¥–ª—è dev:
```
DATABASE_URL=postgresql+psycopg://user:pass@localhost:5432/mw
REDIS_URL=redis://localhost:6379/0
JWT_SECRET=change_me
B24_BASE_URL=https://example.bitrix24.ru/rest
B24_TOKEN=xxx
ALLOWLIST_IPS=127.0.0.1/32
API_RATE_LIMIT_RPM=600
API_RATE_LIMIT_RPS=30
```
**–í–∞–∂–Ω–æ:** —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –∫–æ–º–º–∏—Ç–∏–º. –î–ª—è Codex –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

- –¶–µ–ª–µ–≤–∞—è –°–£–ë–î: **PostgreSQL 14+**. –°—Ö–µ–º–∞ ‚Äî —Å–æ–≥–ª–∞—Å–Ω–æ **ER + DDL v0.6.4 Unified**.
- –ú–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî SQL‚Äë—Ñ–∞–π–ª—ã –≤ `db/migrations/` (–ø–æ—Ä—è–¥–æ–∫ –ø–æ –≤–µ—Ä—Å–∏–∏).  
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: `make migrate` (psql). –û—Ç–∫–∞—Ç ‚Äî `make rollback` (–µ—Å–ª–∏ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω).
- –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã: `timestamptz (UTC)`, –¥–æ–º–µ–Ω—ã `ru_phone`/`currency_code`, **–Ω–µ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** —Ñ–æ—Ç–æ/—Ñ–∞–π–ª–æ–≤.

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ü–î–Ω

- –ü–î–Ω (—Ç–µ–ª–µ—Ñ–æ–Ω/–∞–¥—Ä–µ—Å/—Ñ–æ—Ç–æ) –≤ –ë–î –Ω–µ —Ö—Ä–∞–Ω–∏–º (—Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏/ID).  
- –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ü–î–Ω –≤ –ª–æ–≥–∞—Ö.  
- HTTPS –≤–µ–∑–¥–µ; —Ç–æ–∫–µ–Ω—ã –≤ Secret Manager (–ª–æ–∫–∞–ª—å–Ω–æ ‚Äî –≤ `.env`).

---

## üí¨ –°—Ç–∞—Ç—É—Å—ã, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ —Ä–µ—Ç—Ä–∞–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞)

- **–°—Ç–∞—Ç—É—Å—ã**: –ø–æ **Status‚ÄëDictionary v1**; PATCH `/tasks/{id}` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π; `POST /tasks/{id}/status` ‚Äî deprecated.  
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: `Idempotency-Key` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π; TTL 72—á; —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å `(key, endpoint, actor_id)`; –ø–æ–≤—Ç–æ—Ä —Å –∏–Ω—ã–º —Ç–µ–ª–æ–º ‚Üí 409.  
- **–†–µ—Ç—Ä–∞–∏ –≤ Bitrix24**: backoff 5s‚Üí15s‚Üí30s‚Üí‚Ä¶ –¥–æ 15–º–∏–Ω; –º–∞–∫—Å–∏–º—É–º 20 –ø–æ–ø—ã—Ç–æ–∫/24—á; –ø—Ä–∏ 429 ‚Äî `Retry-After`.

---

## üß≠ Git‚Äë–ø—Ä–∞–∫—Ç–∏–∫–∏

- –í–µ—Ç–∫–∏: `main` (stable), `develop` (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è), `feature/<ticket>`, `fix/<ticket>`.
- –ö–æ–º–º–∏—Ç—ã: `[scope] –∫—Ä–∞—Ç–∫–æ` (–Ω–∞–ø—Ä. `[api] add /returns reject`), –æ–ø–∏—Å–∞–Ω–∏–µ —á—Ç–æ/–∑–∞—á–µ–º.
- PR: —á–µ–∫‚Äë–ª–∏—Å—Ç ‚Äî —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ, –ª–∏–Ω—Ç–µ—Ä—ã –ø—Ä–æ–π–¥–µ–Ω—ã, –∫–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è, –ø–æ–∫—Ä—ã—Ç–∏–µ ‚â•85%.

---

## ‚ö° –ü—Ä–∏–º–µ—Ä—ã –∑–∞–¥–∞—á –¥–ª—è Codex/—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- **–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã:** _–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å OpenAPI –ø–æ Pydantic‚Äë—Å—Ö–µ–º–∞–º, –∑–∞–ø—É—Å—Ç–∏—Ç—å `make check-openapi`, —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å API‚ÄëContracts v1.1.3._
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** _–î–æ–±–∞–≤–∏—Ç—å storage `(key, endpoint, actor_id)` –∏ middleware, –ø–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ –ø–æ–≤—Ç–æ—Ä 200/201 –∏ 409._
- **Bitrix24:** _–ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `tasks.task.add/update` —Å —Ä–µ—Ç—Ä–∞—è–º–∏/–ª–∏–º–∏—Ç–∞–º–∏ –∏ problem+json‚Äë–æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫._
- **–í–æ–∑–≤—Ä–∞—Ç—ã:** _–≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/v1/returns/{id}/reject` + —é–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç—ã —Å—Ç–∞—Ç—É—Å–æ–≤/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π._
- **–†—é–∫–∑–∞–∫:** _`/api/v1/couriers/{id}/stock` GET+POST, ETag/If‚ÄëNone‚ÄëMatch, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ._
- **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å:** _–ü—Ä–æ–º–µ—Ç–µ–π‚Äë–º–µ—Ç—Ä–∏–∫–∏: –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–µ–ª—å—Ç, —Ä–µ—Ç—Ä–∞–∏, –¥—É–±–ª–∏–∫–∞—Ç—ã/1000 POST; –∞–ª–µ—Ä—Ç—ã –ø–æ 00‚ÄëCore._
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** _–ü–æ–¥–ø–∏—Å—å –≤–µ–±—Ö—É–∫–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–Ω–∞ ¬±5 –º–∏–Ω, –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤._

---

## üìÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- –î–æ–ø–æ–ª–Ω—è–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –ø–æ –º–µ—Ä–µ —Ä–∞–∑–≤–∏—Ç–∏—è. –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç/–ë–î, –¥–æ–ª–∂–Ω—ã —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—Å–º. ¬´–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏¬ª).
- –í–æ–ø—Ä–æ—Å—ã –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º ‚Äî –≤ Issues/PR –∏–ª–∏ —á–µ—Ä–µ–∑ Codex ¬´Ask¬ª.  

‚Äî –ö–æ–Ω–µ—Ü ‚Äî
